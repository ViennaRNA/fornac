!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.rnaplot=e():t.rnaplot=e()}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var s=n[r]={exports:{},id:r,loaded:!1};return t[r].call(s.exports,s,s.exports,e),s.loaded=!0,s.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){t.exports=n(3)},function(t,e,n){"use strict";function r(){var t=(new Date).getTime(),e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?n:3&n|8).toString(16)});return e}function s(t,e,n){var s=this;s.type="protein",s.size=e,s.nodes=[{name:"P",num:1,radius:3*Math.sqrt(e),rna:s,nodeType:"protein",structName:t,elemType:"p",size:e,uid:r()}],s.links=[],s.uid=r(),s.addUids=function(t){for(var e=0;e<t.length;e++)s.nodes[e].uid=t[e];return s},s.getUids=function(){uids=[];for(var t=0;t<s.dotbracket.length;t++)uids.push(s.nodes[t].uid);return uids}}function o(t,e,n,s){var o=this;o.type="rna",o.circularizeExternal=!1,0===arguments.length?(o.seq="",o.dotbracket="",o.structName=""):(o.seq=t,o.dotbracket=e,o.structName=n),arguments.length<4&&(s=1),o.circular=!1,o.dotbracket.length>0&&"*"==o.dotbracket[o.dotbracket.length-1]&&(o.dotbracket=o.dotbracket.slice(0,o.dotbracket.length-1),o.circular=!0),o.uid=r(),o.elements=[],o.pseudoknotPairs=[],o.nucsToNodes={},o.addUids=function(t){for(var e=o.nodes.filter(function(t){return"nucleotide"==t.nodeType}),n=0;n<t.length&&n<e.length;n++)e[n].uid=t[n];return o},o.computePairtable=function(){o.pairtable=a.rnaUtilities.dotbracketToPairtable(o.dotbracket)},o.removeBreaks=function(t){for(var e=[],n=-1;(n=t.indexOf("&"))>=0;)e.push(n),t=t.substring(0,n)+"oo"+t.substring(n+1,t.length);return{targetString:t,breaks:e}};var i=o.removeBreaks(o.dotbracket);o.dotbracket=i.targetString,o.dotBracketBreaks=i.breaks,i=o.removeBreaks(o.seq),o.seq=i.targetString,o.seqBreaks=i.breaks,o.calculateStartNumberArray=function(){o.startNumberArray=[];for(var t=0;t<o.dotbracket.length;t++)o.startNumberArray.push(s),"o"==o.dotbracket[t]&&(s=-t)},o.calculateStartNumberArray(),o.rnaLength=o.dotbracket.length,(0,a.arraysEqual)(o.dotBracketBreaks,o.seqBreaks)||(console.log("WARNING: Sequence and structure breaks not equal"),console.log("WARNING: Using the breaks in the structure")),o.computePairtable(),o.addPositions=function(t,e){for(var n=o.nodes.filter(function(e){return e.nodeType==t}),r=0;r<n.length;r++)n[r].x=e[r][0],n[r].px=e[r][0],n[r].y=e[r][1],n[r].py=e[r][1];return o},o.breakNodesToFakeNodes=function(){for(var t=o.nodes.filter(function(t){return"nucleotide"==t.nodeType}),e=0;e<t.length;e++)"o"==o.dotbracket[e]&&(t[e].nodeType="middle");for(var e=0;e<o.elements.length;e++){for(var n=!1,r=0;r<o.elements[e][2].length;r++)o.dotBracketBreaks.indexOf(o.elements[e][2][r])>=0&&(n=!0);n?o.elements[e][2].map(function(t){0!=t&&(o.nodes[t-1].elemType="e")}):o.elements[e][2].map(function(t){0!=t&&(o.nodes[t-1].elemType=o.elements[e][0])})}return o},o.getPositions=function(t){for(var e=[],n=o.nodes.filter(function(e){return e.nodeType==t}),r=0;r<n.length;r++)e.push([n[r].x,n[r].y]);return e},o.getUids=function(){for(var t=[],e=0;e<o.dotbracket.length;e++)t.push(o.nodes[e].uid);return t},o.reinforceStems=function(){for(var t=o.pairtable,e=o.elements.filter(function(t){return"s"==t[0]&&t[2].length>=4}),n=0;n<e.length;n++)for(var r=e[n][2],s=r.slice(0,r.length/2),i=0;i<s.length-1;i++)o.addFakeNode([s[i],s[i+1],t[s[i+1]],t[s[i]]]);return o},o.reinforceLoops=function(){for(var t=function(t){return 0!==t&&t<=o.dotbracket.length},e=0;e<o.elements.length;e++)if("s"!=o.elements[e][0]&&(o.circularizeExternal||"e"!=o.elements[e][0])){var n=o.elements[e][2].filter(t);if("e"==o.elements[e][0]){var s={name:"",num:-3,radius:0,rna:o,nodeType:"middle",elemType:"f",nucs:[],x:o.nodes[o.rnaLength-1].x,y:o.nodes[o.rnaLength-1].y,px:o.nodes[o.rnaLength-1].px,py:o.nodes[o.rnaLength-1].py,uid:r()},i={name:"",num:-2,radius:0,rna:o,nodeType:"middle",elemType:"f",nucs:[],x:o.nodes[0].x,y:o.nodes[0].y,px:o.nodes[0].px,py:o.nodes[0].py,uid:r()};n.push(o.nodes.length+1),n.push(o.nodes.length+2),o.nodes.push(s),o.nodes.push(i)}o.addFakeNode(n)}return o},o.updateLinkUids=function(){for(var t=0;t<o.links.length;t++)o.links[t].uid=o.links[t].source.uid+o.links[t].target.uid;return o},o.addFakeNode=function(t){for(var e=18,n=6.283/(2*t.length),s=e/(2*Math.tan(n)),i="",a=0;a<t.length;a++)i+=o.nodes[t[a]-1].uid;var u={name:"",num:-1,radius:s,rna:o,nodeType:"middle",elemType:"f",nucs:t,uid:i};o.nodes.push(u);var l=0,c=0,h=0;n=3.14159*(t.length-2)/(2*t.length),s=.5/Math.cos(n);for(var d=0;d<t.length;d++)if(!(0===t[d]||t[d]>o.dotbracket.length)){o.links.push({source:o.nodes[t[d]-1],target:o.nodes[o.nodes.length-1],linkType:"fake",value:s,uid:r()}),t.length>4&&o.links.push({source:o.nodes[t[d]-1],target:o.nodes[t[(d+Math.floor(t.length/2))%t.length]-1],linkType:"fake",value:2*s,uid:r()});var g=3.14159*(t.length-2)/t.length,p=2*Math.cos(1.570795-g/2);o.links.push({source:o.nodes[t[d]-1],target:o.nodes[t[(d+2)%t.length]-1],linkType:"fake",value:p});var f=o.nodes[t[d]-1];"x"in f&&(l+=f.x,c+=f.y,h+=1)}return h>0&&(u.x=l/h,u.y=c/h,u.px=u.x,u.py=u.y),o},o.connectFakeNodes=function(){for(var t=18,e=function(t){return"middle"==t.nodeType},n={},r=o.nodes.filter(e),s=new Set,i=1;i<=o.nodes.length;i++)n[i]=[];for(var i=0;i<r.length;i++)for(var a=r[i],u=0;u<a.nucs.length;u++){for(var l=a.nucs[u],c=0;c<n[l].length;c++)if(!s.has(JSON.stringify([n[l][c].uid,a.uid].sort()))){var h=n[l][c].radius+a.radius;o.links.push({source:n[l][c],target:a,value:h/t,linkType:"fake_fake"}),s.add(JSON.stringify([n[l][c].uid,a.uid].sort()))}n[l].push(a)}return o},o.addExtraLinks=function(t){if("undefined"==typeof t)return o;for(var e=0;e<t.length;e++){var n=o.getNodeFromNucleotides(t[e].from),s=o.getNodeFromNucleotides(t[e].to),i={source:n,target:s,linkType:"extra",extraLinkType:t[e].linkType,uid:r()};o.links.push(i)}return o},o.elementsToJson=function(){var t=o.pairtable;o.elements;o.nodes=[],o.links=[];var e={};o.elements.sort();for(var n=0;n<o.elements.length;n++)for(var s=o.elements[n][2],i=0;i<s.length;i++)e[s[i]]=o.elements[n][0];for(var n=1;n<=t[0];n++){var a=o.seq[n-1];(o.dotBracketBreaks.indexOf(n-1)>=0||o.dotBracketBreaks.indexOf(n-2)>=0)&&(a=""),o.nodes.push({name:a,num:n+o.startNumberArray[n-1]-1,radius:5,rna:o,nodeType:"nucleotide",structName:o.structName,elemType:e[n],uid:r(),linked:!1})}for(var n=0;n<o.nodes.length;n++)0===n?o.nodes[n].prevNode=null:o.nodes[n].prevNode=o.nodes[n-1],n==o.nodes.length-1?o.nodes[n].nextNode=null:o.nodes[n].nextNode=o.nodes[n+1];for(var n=1;n<=t[0];n++)0!==t[n]&&o.links.push({source:o.nodes[n-1],target:o.nodes[t[n]-1],linkType:"basepair",value:1,uid:r()}),n>1&&o.dotBracketBreaks.indexOf(n-1)===-1&&o.dotBracketBreaks.indexOf(n-2)==-1&&o.dotBracketBreaks.indexOf(n-3)==-1&&(o.links.push({source:o.nodes[n-2],target:o.nodes[n-1],linkType:"backbone",value:1,uid:r()}),o.nodes[n-1].linked=!0);for(var n=0;n<o.pseudoknotPairs.length;n++)o.links.push({source:o.nodes[o.pseudoknotPairs[n][0]-1],target:o.nodes[o.pseudoknotPairs[n][1]-1],linkType:"pseudoknot",value:1,uid:r()});return o.circular&&o.links.push({source:o.nodes[0],target:o.nodes[o.rnaLength-1],linkType:"backbone",value:1,uid:r()}),o},o.ptToElements=function(t,e,n,r){var s=[],i=[n-1],a=[r+1];if(n>r)return[];for(;0===t[n];n++)i.push(n);for(;0===t[r];r--)a.push(r);if(n>r){if(i.push(n),0===e)return[["e",e,i.sort(u)]];for(var l=!1,c=[],h=[],d=0;d<i.length;d++)l?h.push(i[d]):c.push(i[d]),o.dotBracketBreaks.indexOf(i[d])>=0&&(l=!0);return l?[["h",e,i.sort(u)]]:[["h",e,i.sort(u)]]}if(t[n]!=r){var g=i,d=n;for(g.push(d);d<=r;){for(s=s.concat(o.ptToElements(t,e,d,t[d])),g.push(t[d]),d=t[d]+1;0===t[d]&&d<=r;d++)g.push(d);g.push(d)}return g.pop(),g=g.concat(a),g.length>0&&(0===e?s.push(["e",e,g.sort(u)]):s.push(["m",e,g.sort(u)])),s}if(t[n]===r){i.push(n),a.push(r);var p=i.concat(a);p.length>4&&(0===e?s.push(["e",e,i.concat(a).sort(u)]):s.push(["i",e,i.concat(a).sort(u)]))}for(var f=[];t[n]===r&&n<r;)f.push(n),f.push(r),n+=1,r-=1,e+=1;return i=[n-1],a=[r+1],s.push(["s",e,f.sort(u)]),s.concat(o.ptToElements(t,e,n,r))},o.addLabels=function(t,e){if(0===arguments.length&&(t=1,e=10),1===arguments.length&&(e=10),0===e)return o;e<=0&&console.log("The label interval entered in invalid:",e);for(var n=1;n<=o.pairtable[0];n++)if(n%e===0){var s,i,a,u,l,c,h=o.nodes[n-1];1==o.rnaLength?(c=[h.x-15,h.y],l=[h.x-15,h.y]):(a=1==n?o.nodes[o.rnaLength-1]:o.nodes[n-2],u=n==o.rnaLength?o.nodes[0]:o.nodes[n],0!==o.pairtable[u.num]&&0!==o.pairtable[a.num]&&0!==o.pairtable[h.num]&&(a=u=o.nodes[o.pairtable[h.num]-1]),0===o.pairtable[h.num]||0!==o.pairtable[u.num]&&0!==o.pairtable[a.num]?(c=[u.x-h.x,u.y-h.y],l=[a.x-h.x,a.y-h.y]):(c=[h.x-u.x,h.y-u.y],l=[h.x-a.x,h.y-a.y]));var d=[c[0]+l[0],c[1]+l[1]],g=Math.sqrt(d[0]*d[0]+d[1]*d[1]),p=[d[0]/g,d[1]/g],f=[-15*p[0],-15*p[1]],s=o.nodes[n-1].x+f[0],i=o.nodes[n-1].y+f[1],b={name:n+o.startNumberArray[n-1]-1,num:-1,radius:6,rna:o,nodeType:"label",structName:o.structName,elemType:"l",x:s,y:i,px:s,py:i,uid:r()},y={source:o.nodes[n-1],target:b,value:1,linkType:"label_link",uid:r()};o.nodes.push(b),o.links.push(y)}return o},o.recalculateElements=function(){if(o.removePseudoknots(),o.elements=o.ptToElements(o.pairtable,0,1,o.dotbracket.length),o.circular&&(externalLoop=o.elements.filter(function(t){if("e"==t[0])return!0}),externalLoop.length>0)){eloop=externalLoop[0],nucs=eloop[2].sort(u),prev=nucs[0],hloop=!0,numGreater=0;for(var t=1;t<nucs.length;t++)nucs[t]-prev>1&&(numGreater+=1),prev=nucs[t];1==numGreater?eloop[0]="h":2==numGreater?eloop[0]="i":eloop[0]="m"}return o},o.reassignLinkUids=function(){for(var t,t=0;t<o.links.length;t++)o.links[t].uid=o.links[t].source.uid+o.links[t].target.uid;return o},o.removePseudoknots=function(){return o.pairtable.length>1&&(o.pseudoknotPairs=o.pseudoknotPairs.concat(a.rnaUtilities.removePseudoknotsFromPairtable(o.pairtable))),o},o.addPseudoknots=function(){for(var t=o.pairtable,e=o.pseudoknotPairs,n=0;n<e.length;n++)t[e[n][0]]=e[n][1],t[e[n][1]]=e[n][0];return o.pseudoknotPairs=[],o},o.addName=function(t){return"undefined"==typeof t?(o.name="",o):(o.name=t,o)},o.rnaLength>0&&o.recalculateElements()}function i(t){for(var e={},n=[],i=[],a=0;a<t.molecules.length;a++){var u,l=t.molecules[a];"rna"==l.type?(u=new o(l.seq,l.ss,l.header),u.circularizeExternal=!0,u.elementsToJson().addPositions("nucleotide",l.positions).addLabels().reinforceStems().reinforceLoops()):"protein"==l.type&&(u=new s(l.header,l.size)),u.addUids(l.uids);for(var c=0;c<u.nodes.length;c++)e[u.nodes[c].uid]=u.nodes[c];n.push(u)}for(var a=0;a<t.extraLinks.length;a++)link=t.extraLinks[a],link.source=e[link.source],link.target=e[link.target],link.uid=r(),i.push(link);return{graphs:n,extraLinks:i}}Object.defineProperty(e,"__esModule",{value:!0}),e.ProteinGraph=s,e.RNAGraph=o,e.moleculesToJson=i;var a=n(2),u=function(t,e){return t-e};"undefined"==typeof String.prototype.trim&&(String.prototype.trim=function(){return String(this).replace(/^\s+|\s+$/g,"")})},function(t,e,n){!function(e,n){t.exports=n()}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var s=n[r]={exports:{},id:r,loaded:!1};return t[r].call(s.exports,s,s.exports,e),s.loaded=!0,s.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){t.exports=n(1)},function(t,e){"use strict";function n(t,e){if(t===e)return!0;if(null===t||null===e)return!1;if(t.length!=e.length)return!1;for(var n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}function r(){var t=this;t.bracketLeft="([{<ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),t.bracketRight=")]}>abcdefghijklmnopqrstuvwxyz".split(""),t.inverseBrackets=function(t){for(var e={},n=0;n<t.length;n++)e[t[n]]=n;return e},t.maximumMatching=function(t){for(var e=t[0],n=0,r=new Array(e+1),s=0;e>=s;s++){r[s]=new Array(e+1);for(var o=s;e>=o;o++)r[s][o]=0}for(var i=0,s=e-n-1;s>0;s--)for(var o=s+n+1;e>=o;o++){i=r[s][o-1];for(var a=o-n-1;a>=s;a--)t[a]===o&&(i=Math.max(i,(a>s?r[s][a-1]:0)+1+(o-a-1>0?r[a+1][o-1]:0)));r[s][o]=i}return i=r[1][e],r},t.backtrackMaximumMatching=function(e,n){var r=Array.apply(null,Array(e.length)).map(function(){return 0});return t.mmBt(e,r,n,1,e.length-1),r},t.mmBt=function(e,n,r,s,o){var i=e[s][o],a=0;if(!(a>o-s-1)){if(e[s][o-1]==i)return void t.mmBt(e,n,r,s,o-1);for(var u=o-a-1;u>=s;u--)if(r[o]===u){var l=u>s?e[s][u-1]:0,c=o-u-1>0?e[u+1][o-1]:0;if(l+c+1==i)return n[u]=o,n[o]=u,u>s&&t.mmBt(e,n,r,s,u-1),void t.mmBt(e,n,r,u+1,o-1)}console.log("FAILED!!!"+s+","+o+": backtracking failed!")}},t.dotbracketToPairtable=function(e){var n=Array.apply(null,new Array(e.length+1)).map(Number.prototype.valueOf,0);n[0]=e.length;for(var r={},s=0;s<t.bracketLeft.length;s++)r[s]=[];for(var o=t.inverseBrackets(t.bracketLeft),i=t.inverseBrackets(t.bracketRight),s=0;s<e.length;s++){var a=e[s],u=s+1;if("."==a||"o"==a)n[u]=0;else if(a in o)r[o[a]].push(u);else{if(!(a in i))throw"Unknown symbol in dotbracket string";var l=r[i[a]].pop();n[u]=l,n[l]=u}}for(var c in r)if(r[c].length>0)throw"Unmatched base at position "+r[c][0];return n},t.insertIntoStack=function(t,e,n){for(var r=0;t[r].length>0&&t[r][t[r].length-1]<n;)r+=1;return t[r].push(n),r},t.deleteFromStack=function(t,e){for(var n=0;0===t[n].length||t[n][t[n].length-1]!=e;)n+=1;return t[n].pop(),n},t.pairtableToDotbracket=function(e){for(var n={},r=0;r<e[0];r++)n[r]=[];for(var r,s={},o="",r=1;r<e[0]+1;r++){if(0!==e[r]&&e[r]in s)throw"Invalid pairtable contains duplicate entries";s[e[r]]=!0,o+=0===e[r]?".":e[r]>r?t.bracketLeft[t.insertIntoStack(n,r,e[r])]:t.bracketRight[t.deleteFromStack(n,r)]}return o},t.findUnmatched=function(e,n,r){for(var s,o=[],i=[],a=n,u=r,s=n;r>=s;s++)0!==e[s]&&(e[s]<n||e[s]>r)&&i.push([s,e[s]]);for(var s=a;u>=s;s++){for(;0===e[s]&&u>=s;)s++;for(r=e[s];e[s]===r;)s++,r--;o=o.concat(t.findUnmatched(e,s,r))}return i.length>0&&o.push(i),o},t.removePseudoknotsFromPairtable=function(e){for(var n=t.maximumMatching(e),r=t.backtrackMaximumMatching(n,e),s=[],o=1;o<e.length;o++)e[o]<o||r[o]!=e[o]&&(s.push([o,e[o]]),e[e[o]]=0,e[o]=0);return s},t.ptToElements=function(e,n,r,s,i){var a=[],u=[r-1],l=[s+1];if(arguments.length<5&&(i=[]),r>s)return[];for(;0===e[r];r++)u.push(r);for(;0===e[s];s--)l.push(s);if(r>s){if(u.push(r),0===n)return[["e",n,u.sort(o)]];for(var c=!1,h=[],d=[],g=0;g<u.length;g++)c?d.push(u[g]):h.push(u[g]),i.indexOf(u[g])>=0&&(c=!0);return c?[["h",n,u.sort(o)]]:[["h",n,u.sort(o)]]}if(e[r]!=s){var p=u,g=r;for(p.push(g);s>=g;){for(a=a.concat(t.ptToElements(e,n,g,e[g],i)),p.push(e[g]),g=e[g]+1;0===e[g]&&s>=g;g++)p.push(g);p.push(g)}return p.pop(),p=p.concat(l),p.length>0&&(0===n?a.push(["e",n,p.sort(o)]):a.push(["m",n,p.sort(o)])),a}if(e[r]===s){u.push(r),l.push(s);var f=u.concat(l);f.length>4&&(0===n?a.push(["e",n,u.concat(l).sort(o)]):a.push(["i",n,u.concat(l).sort(o)]))}for(var b=[];e[r]===s&&s>r;)b.push(r),b.push(s),r+=1,s-=1,n+=1;return u=[r-1],l=[s+1],a.push(["s",n,b.sort(o)]),a.concat(t.ptToElements(e,n,r,s,i))}}function s(t){var e=this;return e.colorsText=t,e.parseRange=function(t){for(var e=t.split(","),n=[],r=0;r<e.length;r++){var s=e[r].split("-");if(1==s.length)n.push(parseInt(s[0]));else if(2==s.length)for(var o=parseInt(s[0]),i=parseInt(s[1]),a=o;i>=a;a++)n.push(a);else console.log("Malformed range (too many dashes):",t)}return n},e.parseColorText=function(t){for(var n=t.split("\n"),r="",s=1,o={colorValues:{"":{}},range:["white","steelblue"]},i=[],a=0;a<n.length;a++)if(">"!=n[a][0])for(var u=n[a].trim().split(/[\s]+/),l=0;l<u.length;l++)if(isNaN(u[l])){if(0===u[l].search("range")){var c=u[l].split("="),h=c[1].split(":");o.range=[h[0],h[1]];continue}if(0==u[l].search("domain")){var d=u[l].split("="),h=d[1].split(":");o.domain=[h[0],h[1]];continue}for(var g=u[l].split(":"),p=e.parseRange(g[0]),f=g[1],b=0;b<p.length;b++)isNaN(f)?o.colorValues[r][p[b]]=f:(o.colorValues[r][p[b]]=+f,i.push(Number(f)))}else o.colorValues[r][s]=Number(u[l]),s+=1,i.push(Number(u[l]));else r=n[a].trim().slice(1),s=1,o.colorValues[r]={};return"domain"in o||(o.domain=[Math.min.apply(null,i),Math.max.apply(null,i)]),e.colorsJson=o,e},e.normalizeColors=function(){var t;for(var n in e.colorsJson){var r=Number.MAX_VALUE,s=Number.MIN_VALUE;for(var o in e.colorsJson.colorValues[n])t=e.colorsJson.colorValues[n][o],"number"==typeof t&&(r>t&&(r=t),t>s&&(s=t));for(o in e.colorsJson.colorValues[n])t=e.colorsJson.colorValues[n][o],"number"==typeof t&&(e.colorsJson.colorValues[n][o]=(t-r)/(s-r))}return e},e.parseColorText(e.colorsText),e}Object.defineProperty(e,"__esModule",{value:!0}),e.arraysEqual=n,e.RNAUtilities=r,e.ColorScheme=s;var o=function(t,e){return t-e};e.rnaUtilities=new r}])})},function(t,e,n){"use strict";function r(){function t(t,e){function n(t,e,n){var r=(t.range()[1]-t.range()[0])/(t.domain()[1]-t.domain()[0]),s=(e[1]-e[0])*r,o=(n[1]-n[0]-s)/2;return{scaleFactor:r,scale:d3.scale.linear().domain(e).range([n[0]+o,n[1]-o])}}var r=arguments.length<=2||void 0===arguments[2]?"":arguments[2],s=d3.extent(t),o=d3.extent(e),i=30;""!=r&&(o[1]+=i),s[0]-=h.nucleotideRadius+h.rnaEdgePadding,o[0]-=h.nucleotideRadius+h.rnaEdgePadding,s[1]+=h.nucleotideRadius+h.rnaEdgePadding,o[1]+=h.nucleotideRadius+h.rnaEdgePadding;var a,u=s[1]-s[0],d=o[1]-o[0],g=u-h.width,p=d-h.height;g>p?(l=d3.scale.linear().domain(s).range([0,h.width]),a=n(l,o,[0,h.height]),c=a.scale):(c=d3.scale.linear().domain(o).range([0,h.height]),a=n(c,s,[0,h.width]),l=a.scale);l.range()[0]-l.domain()[0],c.range()[0]-c.domain()[0];return"translate("+-(l.domain()[0]*a.scaleFactor-l.range()[0])+","+-(c.domain()[0]*a.scaleFactor-c.range()[0])+")scale("+a.scaleFactor+")"}function e(t,e){var n=t.selectAll(".rna-base").data(e).enter().append("svg:g").attr("transform",function(t){return"translate("+t.x+","+t.y+")"});n.append("svg:circle").attr("r",h.nucleotideRadius).classed("rna-base",!0);if(h.showNucleotideLabels){n.append("svg:text").text(function(t){return t.name}).attr("text-anchor","middle").attr("dominant-baseline","central").classed("nucleotide-label",!0).append("svg:title").text(function(t){return t.struct_name+":"+t.num})}}function n(t,e){var n=t.selectAll(".rnaLabel").data(e).enter().append("svg:g").attr("transform",function(t){return"translate("+t.x+","+t.y+")"});n.append("svg:text").text(function(t){return t.name}).attr("text-anchor","middle").attr("font-weight","bold").attr("dominant-baseline","central").classed("number-label",!0)}function r(t,e){t.append("svg:text").attr("transform","translate("+l.invert(h.width/2)+","+c.invert(h.height)+")").attr("dy",-10).classed("rna-name",!0).text(e)}function i(t,e){var n={},r=[];e=e.filter(function(t){return"correct"==t.linkType||"incorrect"==t.linkType||"extra"==t.linkType}),t.selectAll("[link-type=extra]").remove();for(var s=0;s<e.length;s++)null!==e[s].source&&null!==e[s].target&&(n[e[s].source.uid]=e[s].source,n[e[s].target.uid]=e[s].target,r.push({source:e[s].source.uid,target:e[s].target.uid,linkType:e[s].linkType,extraLinkType:e[s].extraLinkType}));for(var o=d3.ForceEdgeBundling().nodes(n).edges(r).compatibility_threshold(.8).step_size(.2),i=o(),a=d3.svg.line().x(function(t){return t.x}).y(function(t){return t.y}).interpolate("linear"),s=0;s<i.length;s++){var u=i[s];t.append("path").attr("d",a(u)).style("fill","none").attr("link-type",function(t){return r[s].linkType}).attr("extra-link-type",function(t){return r[s].extraLinkType}).style("stroke-opacity",.4)}}function a(t,e){e=e.filter(function(t){return null!==t.source&&null!==t.target});t.selectAll(".rna-link").data(e).enter().append("svg:line").attr("x1",function(t){return t.source.x}).attr("x2",function(t){return t.target.x}).attr("y1",function(t){return t.source.y}).attr("y2",function(t){return t.target.y}).attr("link-type",function(t){return t.linkType}).attr("extra-link-type",function(t){return t.extraLinkType}).classed("rna-link",!0)}function u(u){u.each(function(u){var l=new s.RNAGraph(u.sequence,u.structure,u.name).recalculateElements().elementsToJson().addName(u.name);u.rnaGraph=l;for(var c=new o.NAView,d=c.naview_xy_coordinates(l.pairtable),g=[],p=0;p<d.nbase;p++)g.push([d.x[p],d.y[p]]);l.addPositions("nucleotide",g).reinforceStems().reinforceLoops().addExtraLinks(u.extraLinks).addLabels(h.startNucleotideNumber,h.labelInterval);var f=t(l.nodes.map(function(t){return t.x}),l.nodes.map(function(t){return t.y})),b=d3.select(this).append("g").attr("transform",f),y=l.nodes.filter(function(t){return"nucleotide"==t.nodeType}),m=l.nodes.filter(function(t){return"label"==t.nodeType}),v=l.links;a(b,v),e(b,y),n(b,m),r(b,u.name),h.bundleExternalLinks&&i(b,v)})}var l,c,h={width:400,height:400,nucleotideRadius:5,rnaEdgePadding:0,labelInterval:0,showNucleotideLabels:!0,startNucleotideNumber:1,bundleExternalLinks:!1};return u.width=function(t){return arguments.length?(h.width=t,u):h.width},u.height=function(t){return arguments.length?(h.height=t,u):h.height},u.showNucleotideLabels=function(t){return arguments.length?(h.showNucleotideLabels=t,u):h.showNucleotideLabels},u.rnaEdgePadding=function(t){return arguments.length?(h.rnaEdgePadding=t,u):h.rnaEdgePadding},u.nucleotideRadius=function(t){return arguments.length?(h.nucleotideRadius=t,u):h.nucleotideRadius},u.labelInterval=function(t){return arguments.length?(h.labelInterval=t,u):h.labelInterval},u.showNucleotideLabels=function(t){return arguments.length?(h.showNucleotideLabels=t,u):h.showNucleotideLabels},u.startNucleotideNumber=function(t){return arguments.length?(h.startNucleotideNumber=t,u):h.startNucleotideNumber},u.bundleExternalLinks=function(t){return arguments.length?(h.bundleExternalLinks=t,u):h.bundleExternalLinks},u}Object.defineProperty(e,"__esModule",{value:!0}),e.rnaPlot=r;var s=(n(4),n(1)),o=n(5);n(2);n(11),"undefined"==typeof String.prototype.trim&&(String.prototype.trim=function(){return String(this).replace(/^\s+|\s+$/g,"")})},function(t,e){"use strict";function n(t){var e,n,r,s=0,o=100,i=100,a=15,u=[],l=[];n=t[0];var c=Array.apply(null,new Array(n+5)).map(Number.prototype.valueOf,0),h=Array.apply(null,new Array(16+Math.floor(n/5))).map(Number.prototype.valueOf,0),d=Array.apply(null,new Array(16+Math.floor(n/5))).map(Number.prototype.valueOf,0),g=0,p=0,f=Math.PI/2,b=function m(t,e,n){var r,s,o,i,a,u,l,b,y,v,k,x,M=2,N=0,E=0,_=Array.apply(null,new Array(3+2*Math.floor((e-t)/5))).map(Number.prototype.valueOf,0);for(r=t-1,e++;t!=e;)if(s=n[t],s&&0!=t){M+=2,o=t,i=s,_[++N]=o,_[++N]=i,t=s+1,a=o,u=i,b=0;do o++,i--,b++;while(n[o]==i&&n[o]>o);if(l=b-2,b>=2&&(c[a+1+l]+=f,c[u-1-l]+=f,c[a]+=f,c[u]+=f,b>2))for(;l>=1;l--)c[a+l]=Math.PI,c[u-l]=Math.PI;d[++p]=b,o<=i&&m(o,i,n)}else t++,M++,E++;for(x=Math.PI*(M-2)/M,_[++N]=e,y=r<0?0:r,v=1;v<=N;v++){for(k=_[v]-y,l=0;l<=k;l++)c[y+l]+=x;if(v>N)break;y=_[++v]}h[++g]=E};b(0,n+1,t),h[g]-=2,r=s,u[0]=o,l[0]=i;var y=[];for(y.push([u[0],l[0]]),e=1;e<n;e++)u[e]=u[e-1]+a*Math.cos(r),l[e]=l[e-1]+a*Math.sin(r),y.push([u[e],l[e]]),r+=Math.PI-c[e+1];return y}Object.defineProperty(e,"__esModule",{value:!0}),e.simpleXyCoordinates=n},function(t,e,n){"use strict";function r(){this.ANUM=9999,this.MAXITER=500,this.bases=[],this.nbase=null,this.nregion=null,this.loop_count=null,this.root=new c.Loop,this.loops=[],this.regions=[],this.rlphead=new i.Radloop,this.lencut=.8,this.RADIUS_REDUCTION_FACTOR=1.4,this.angleinc=null,this._h=null,this.HELIX_FACTOR=.6,this.BACKBONE_DISTANCE=27}function s(){var t=new c.Loop,e=null,n=null;for(e=0;e<this.loop_count;e++){for(t=this.loops[e],n=0;n<this.loop_count;n++)this.loops[n].setMark(!1);t.setDepth(o(t))}}function o(t){var e=null,n=null,r=null;if(t.getNconnection()<=1)return 0;if(t.isMark())return-1;t.setMark(!0),e=0,n=0;for(var s=0;null!=t.getConnection(s);s++)r=o(t.getConnection(s).getLoop()),r>=0&&(1==++e?n=r:n>r&&(n=r));return t.setMark(!1),n+1}Object.defineProperty(e,"__esModule",{value:!0}),e.NAView=r;var i=n(6),a=n(7),u=n(9),l=n(10),c=n(8);r.prototype.naview_xy_coordinates=function(t){var e=[],n=[];if(0===t.length||0===t[0])return 0;var r;this.nbase=t[0],this.bases=[];for(var s=0;s<this.nbase+1;s++)this.bases.push(new l.Base);this.regions=[];for(var s=0;s<this.nbase+1;s++)this.regions.push(new u.Region);this.read_in_bases(t),this.rlphead=null,this.find_regions(),this.loop_count=0,this.loops=[];for(var s=0;s<this.nbase+1;s++)this.loops.push(new c.Loop);for(this.construct_loop(0),this.find_central_loop(),this.traverse_loop(this.root,null),r=0;r<this.nbase;r++)e.push(100+this.BACKBONE_DISTANCE*this.bases[r+1].getX()),n.push(100+this.BACKBONE_DISTANCE*this.bases[r+1].getY());return{nbase:this.nbase,x:e,y:n}},r.prototype.read_in_bases=function(t){var e=null,n=null;for(this.bases.push(new l.Base),this.bases[0].setMate(0),this.bases[0].setExtracted(!1),this.bases[0].setX(this.ANUM),this.bases[0].setY(this.ANUM),n=0,e=1;e<=this.nbase;e++)this.bases.push(new l.Base),this.bases[e].setExtracted(!1),this.bases[e].setX(this.ANUM),this.bases[e].setY(this.ANUM),this.bases[e].setMate(t[e]),t[e]>e&&n++;0==n&&(this.bases[1].setMate(this.nbase),this.bases[this.nbase].setMate(1))},r.prototype.find_regions=function(){var t=null,e=null,n=null;n=this.nbase+1;var r=[];for(t=0;t<n;t++)r.push(!1);for(this.nregion=0,t=0;t<=this.nbase;t++)if(0!=(e=this.bases[t].getMate())&&!r[t]){for(this.regions[this.nregion].setStart1(t),this.regions[this.nregion].setEnd2(e),r[t]=!0,r[e]=!0,this.bases[t].setRegion(this.regions[this.nregion]),this.bases[e].setRegion(this.regions[this.nregion]),t++,e--;t<e&&this.bases[t].getMate()==e;t++,e--)r[e]=!0,r[t]=!0,this.bases[t].setRegion(this.regions[this.nregion]),this.bases[e].setRegion(this.regions[this.nregion]);this.regions[this.nregion].setEnd1(--t),this.regions[this.nregion].setStart2(e+1),this.nregion++}},r.prototype.construct_loop=function(t){var e=null,n=null,r=new c.Loop,s=new c.Loop,o=new a.Connection,l=new u.Region,h=new i.Radloop;for(r=this.loops[this.loop_count++],r.setNconnection(0),r.setDepth(0),r.setNumber(this.loop_count),r.setRadius(0),h=this.rlphead;null!=h;h=h.getNext())h.getLoopnumber()==this.loop_count&&r.setRadius(h.getRadius());e=t;do 0!=(n=this.bases[e].getMate())&&(l=this.bases[e].getRegion(),this.bases[l.getStart1()].isExtracted()||(e==l.getStart1()?(this.bases[l.getStart1()].setExtracted(!0),this.bases[l.getEnd1()].setExtracted(!0),this.bases[l.getStart2()].setExtracted(!0),this.bases[l.getEnd2()].setExtracted(!0),s=this.construct_loop(l.getEnd1()<this.nbase?l.getEnd1()+1:0)):e==l.getStart2()?(this.bases[l.getStart2()].setExtracted(!0),this.bases[l.getEnd2()].setExtracted(!0),this.bases[l.getStart1()].setExtracted(!0),this.bases[l.getEnd1()].setExtracted(!0),s=this.construct_loop(l.getEnd2()<this.nbase?l.getEnd2()+1:0)):console.log("Something went terribly wrong ...."),r.setNconnection(r.getNconnection()+1),o=new a.Connection,r.setConnection(r.getNconnection()-1,o),r.setConnection(r.getNconnection(),null),o.setLoop(s),o.setRegion(l),e==l.getStart1()?(o.setStart(l.getStart1()),o.setEnd(l.getEnd2())):(o.setStart(l.getStart2()),o.setEnd(l.getEnd1())),o.setExtruded(!1),o.setBroken(!1),s.setNconnection(s.getNconnection()+1),o=new a.Connection,s.setConnection(s.getNconnection()-1,o),s.setConnection(s.getNconnection(),null),o.setLoop(r),o.setRegion(l),e==l.getStart1()?(o.setStart(l.getStart2()),o.setEnd(l.getEnd1())):(o.setStart(l.getStart1()),o.setEnd(l.getEnd2())),o.setExtruded(!1),o.setBroken(!1)),e=n),++e>this.nbase&&(e=0);while(e!=t);return r},r.prototype.find_central_loop=function(){var t=new c.Loop,e=null,n=null,r=null;for(s.bind(this)(),e=0,n=-1,r=0;r<this.loop_count;r++)t=this.loops[r],t.getNconnection()>e?(n=t.getDepth(),e=t.getNconnection(),this.root=t):t.getDepth()>n&&t.getNconnection()==e&&(n=t.getDepth(),this.root=t)},r.prototype.traverse_loop=function(t,e){var n,r,s,o,i,a,u,l,c,h,d,g,p,f,b,y,m,v,k,x,M,N,E,_,S,A,w,T,L,P,X,R,C,I,Y,B,O,U,F,q,j,D,J,V,G,z,H,K,W,$,Q,Z,tt,et,nt,rt,st,ot,it,at,ut,lt,ct,ht,dt,gt,pt,ft,bt,yt,mt,vt=0;u=2*Math.PI/(this.nbase+1),k=null,X=-1;var kt=0;for(_=0;null!=(m=t.getConnection(kt));kt++,_++)n=-Math.sin(u*m.getStart()),r=Math.cos(u*m.getStart()),s=-Math.sin(u*m.getEnd()),o=Math.cos(u*m.getEnd()),i=o-r,a=n-s,l=Math.sqrt(i*i+a*a),m.setXrad(i/l),m.setYrad(a/l),m.setAngle(Math.atan2(a,i)),m.getAngle()<0&&m.setAngle(m.getAngle()+2*Math.PI),null!=e&&e.getRegion()==m.getRegion()&&(k=m,X=_);t:for(;;){this.determine_radius(t,this.lencut),c=t.getRadius()/this.RADIUS_REDUCTION_FACTOR,null==e?h=d=0:(g=(this.bases[k.getStart()].getX()+this.bases[k.getEnd()].getX())/2,p=(this.bases[k.getStart()].getY()+this.bases[k.getEnd()].getY())/2,h=g-c*k.getXrad(),d=p-c*k.getYrad()),T=X==-1?0:X,m=t.getConnection(T),w=0,R=!1;do if(N=T-1,N<0&&(N=t.getNconnection()-1),x=t.getConnection(N),this.connected_connection(x,m)?(T=N,m=x):R=!0,++w>t.getNconnection()){for(A=-1,_=0;_<t.getNconnection();_++)N=_+1,N>=t.getNconnection()&&(N=0),m=t.getConnection(_),v=t.getConnection(N),pt=v.getAngle()-m.getAngle(),pt<0&&(pt+=2*Math.PI),pt>A&&(A=pt,vt=_);L=vt,T=vt+1,T>=t.getNconnection()&&(T=0),m=t.getConnection(L),m.setBroken(!0),R=!0}while(!R);for(C=!1,H=T;!C;){for(w=0,R=!1,L=T,I=!1;!R;)if(m=t.getConnection(L),L==X&&(I=!0),N=L+1,N>=t.getNconnection()&&(N=0),v=t.getConnection(N),this.connected_connection(m,v)){if(++w>=t.getNconnection())break;L=N}else R=!0;for(P=this.find_ic_middle(T,L,e,k,t),_=K=W=P,R=!1,Q=0;!R;)_=Q<0?K:0==Q?P:W,_>=0&&(m=t.getConnection(_),null!=e&&k==m||(0==Q?(f=m.getAngle()-Math.asin(.5/c),b=m.getAngle()+Math.asin(.5/c),this.bases[m.getStart()].setX(h+c*Math.cos(f)),this.bases[m.getStart()].setY(d+c*Math.sin(f)),this.bases[m.getEnd()].setX(h+c*Math.cos(b)),this.bases[m.getEnd()].setY(d+c*Math.sin(b))):Q<0?(N=_+1,N>=t.getNconnection()&&(N=0),m=t.getConnection(_),v=t.getConnection(N),rt=m.getXrad(),st=m.getYrad(),pt=(m.getAngle()+v.getAngle())/2,m.getAngle()>v.getAngle()&&(pt-=Math.PI),at=Math.cos(pt),ut=Math.sin(pt),ht=ut,dt=-at,S=v.getAngle()-m.getAngle(),S<0&&(S+=2*Math.PI),gt=m.isExtruded()?S<=Math.PI/2?2:1.5:1,this.bases[m.getEnd()].setX(this.bases[v.getStart()].getX()+gt*ht),this.bases[m.getEnd()].setY(this.bases[v.getStart()].getY()+gt*dt),this.bases[m.getStart()].setX(this.bases[m.getEnd()].getX()+st),this.bases[m.getStart()].setY(this.bases[m.getEnd()].getY()-rt)):(N=_-1,N<0&&(N=t.getNconnection()-1),m=t.getConnection(N),v=t.getConnection(_),ot=v.getXrad(),it=v.getYrad(),pt=(m.getAngle()+v.getAngle())/2,m.getAngle()>v.getAngle()&&(pt-=Math.PI),at=Math.cos(pt),ut=Math.sin(pt),ht=-ut,dt=at,S=v.getAngle()-m.getAngle(),S<0&&(S+=2*Math.PI),gt=m.isExtruded()?S<=Math.PI/2?2:1.5:1,this.bases[v.getStart()].setX(this.bases[m.getEnd()].getX()+gt*ht),this.bases[v.getStart()].setY(this.bases[m.getEnd()].getY()+gt*dt),this.bases[v.getEnd()].setX(this.bases[v.getStart()].getX()-it),this.bases[v.getEnd()].setY(this.bases[v.getStart()].getY()+ot)))),Q<0?(W==L?W=-1:W>=0&&++W>=t.getNconnection()&&(W=0),Q=1):(K==T?K=-1:K>=0&&--K<0&&(K=t.getNconnection()-1),Q=-1),R=K==-1&&W==-1;if($=L+1,$>=t.getNconnection()&&($=0),L!=T&&(T!=H||$!=H))if(m=t.getConnection(T),v=t.getConnection(L),tt=this.bases[v.getEnd()].getX()-this.bases[m.getStart()].getX(),et=this.bases[v.getEnd()].getY()-this.bases[m.getStart()].getY(),B=this.bases[m.getStart()].getX()+tt/2,O=this.bases[m.getStart()].getY()+et/2,nt=Math.sqrt(tt*tt+et*et),q=tt/nt,j=et/nt,D=h-B,J=d-O,nt=Math.sqrt(tt*tt+et*et),D/=nt,J/=nt,V=D*q+J*j,U=V*q-D,F=V*j-J,nt=Math.sqrt(U*U+F*F),U/=nt,F/=nt,tt=this.bases[m.getStart()].getX()-h,et=this.bases[m.getStart()].getY()-d,pt=Math.atan2(et,tt),pt<0&&(pt+=2*Math.PI),tt=this.bases[v.getEnd()].getX()-h,et=this.bases[v.getEnd()].getY()-d,ft=Math.atan2(et,tt),ft<0&&(ft+=2*Math.PI),ft<pt&&(ft+=2*Math.PI),Y=ft-pt>Math.PI?-1:1,G=h+Y*c*U,z=d+Y*c*F,I)h-=G-B,d-=z-O;else for(_=T;m=t.getConnection(_),M=m.getStart(),this.bases[M].setX(this.bases[M].getX()+G-B),this.bases[M].setY(this.bases[M].getY()+z-O),M=m.getEnd(),this.bases[M].setX(this.bases[M].getX()+G-B),this.bases[M].setY(this.bases[M].getY()+z-O),_!=L;)++_>=t.getNconnection()&&(_=0);
T=$,C=T==H}for(_=0;_<t.getNconnection();_++){if(m=t.getConnection(_),N=_+1,N>=t.getNconnection()&&(N=0),v=t.getConnection(N),tt=this.bases[m.getEnd()].getX()-h,et=this.bases[m.getEnd()].getY()-d,ct=Math.sqrt(tt*tt+et*et),pt=Math.atan2(et,tt),pt<0&&(pt+=2*Math.PI),tt=this.bases[v.getStart()].getX()-h,et=this.bases[v.getStart()].getY()-d,lt=Math.sqrt(tt*tt+et*et),ft=Math.atan2(et,tt),ft<0&&(ft+=2*Math.PI),ft<pt&&(ft+=2*Math.PI),Z=ft-pt,mt=v.getAngle()-m.getAngle(),mt<=0&&(mt+=2*Math.PI),Math.abs(Z-mt)>Math.PI)if(m.isExtruded())console.log("Warning from traverse_loop. Loop "+t.getNumber()+" has crossed regions\n");else if(v.getStart()-m.getEnd()!=1){m.setExtruded(!0);continue t}if(m.isExtruded())this.construct_extruded_segment(m,v);else for(E=v.getStart()-m.getEnd(),E<0&&(E+=this.nbase+1),u=Z/E,N=1;N<E;N++)M=m.getEnd()+N,M>this.nbase&&(M-=this.nbase+1),y=pt+N*u,nt=ct+(lt-ct)*(y-pt)/Z,this.bases[M].setX(h+nt*Math.cos(y)),this.bases[M].setY(d+nt*Math.sin(y))}break}for(_=0;_<t.getNconnection();_++)X!=_&&(m=t.getConnection(_),this.generate_region(m),this.traverse_loop(m.getLoop(),m));for(E=0,bt=0,yt=0,_=0;_<t.getNconnection();_++)if(N=_+1,N>=t.getNconnection()&&(N=0),m=t.getConnection(_),v=t.getConnection(N),E+=2,bt+=this.bases[m.getStart()].getX()+this.bases[m.getEnd()].getX(),yt+=this.bases[m.getStart()].getY()+this.bases[m.getEnd()].getY(),!m.isExtruded())for(N=m.getEnd()+1;N!=v.getStart();N++)N>this.nbase&&(N-=this.nbase+1),E++,bt+=this.bases[N].getX(),yt+=this.bases[N].getY();t.setX(bt/E),t.setY(yt/E)},r.prototype.determine_radius=function(t,e){var n,r,s,o,i,u,l,c,h,d,g,p=0,f=new a.Connection,b=new a.Connection,y=.7071068;do{for(n=1e10,i=0,o=0,c=0;c<t.getNconnection();c++)f=t.getConnection(c),h=c+1,h>=t.getNconnection()&&(h=0),b=t.getConnection(h),d=f.getEnd(),g=b.getStart(),g<d&&(g+=this.nbase+1),s=b.getAngle()-f.getAngle(),s<=0&&(s+=2*Math.PI),r=f.isExtruded()?s<=Math.PI/2?2:1.5:g-d,o+=s*(1/r+1),i+=s*s/r,l=s/r,l<n&&!f.isExtruded()&&r>1&&(n=l,p=c);u=o/i,u<y&&(u=y),n*u<e&&t.getConnection(p).setExtruded(!0)}while(n*u<e);t.getRadius()>0?u=t.getRadius():t.setRadius(u)},r.prototype.find_ic_middle=function(t,e,n,r,s){var o,i,a,u,l;for(o=0,i=-1,a=t,l=!1;!l;)o++>2*s.getNconnection()&&console.log("Infinite loop in 'find_ic_middle'"),null!=n&&s.getConnection(a)==r&&(i=a),l=a==e,++a>=s.getNconnection()&&(a=0);if(i==-1){for(u=1,a=t;u<(o+1)/2;u++)++a>=s.getNconnection()&&(a=0);i=a}return i},r.prototype.construct_extruded_segment=function(t,e){var n,r,s,o,i,a,u,l,c,h,d,g,p,f,b,y,m,v;if(n=t.getAngle(),s=r=e.getAngle(),s<n&&(s+=2*Math.PI),o=(n+s)/2,p=t.getEnd(),f=e.getStart(),b=f-p,b<0&&(b+=this.nbase+1),d=e.getAngle()-t.getAngle(),d<0&&(d+=2*Math.PI),2==b)this.construct_circle_segment(p,f);else{i=this.bases[f].getX()-this.bases[p].getX(),a=this.bases[f].getY()-this.bases[p].getY(),h=Math.sqrt(i*i+a*a),i/=h,a/=h,h>=1.5&&d<=Math.PI/2&&(y=p+1,y>this.nbase&&(y-=this.nbase+1),m=f-1,m<0&&(m+=this.nbase+1),this.bases[y].setX(this.bases[p].getX()+.5*i),this.bases[y].setY(this.bases[p].getY()+.5*a),this.bases[m].setX(this.bases[f].getX()-.5*i),this.bases[m].setY(this.bases[f].getY()-.5*a),p=y,f=m);do v=!1,this.construct_circle_segment(p,f),y=p+1,y>this.nbase&&(y-=this.nbase+1),i=this.bases[y].getX()-this.bases[p].getX(),a=this.bases[y].getY()-this.bases[p].getY(),u=Math.atan2(a,i),u<0&&(u+=2*Math.PI),g=u-n,g<0&&(g+=2*Math.PI),g>Math.PI&&(v=!0),m=f-1,m<0&&(m+=this.nbase+1),i=this.bases[m].getX()-this.bases[f].getX(),a=this.bases[m].getY()-this.bases[f].getY(),l=Math.atan2(a,i),l<0&&(l+=2*Math.PI),g=r-l,g<0&&(g+=2*Math.PI),g>Math.PI&&(v=!0),v&&(c=this.minf2(o,n+.5),this.bases[y].setX(this.bases[p].getX()+Math.cos(c)),this.bases[y].setY(this.bases[p].getY()+Math.sin(c)),p=y,c=this.maxf2(o,s-.5),this.bases[m].setX(this.bases[f].getX()+Math.cos(c)),this.bases[m].setY(this.bases[f].getY()+Math.sin(c)),f=m,b-=2);while(v&&b>1)}},r.prototype.construct_circle_segment=function(t,e){var n,r,s,o,i,a,u,l,c,h,d,g,p,f,b;if(n=this.bases[e].getX()-this.bases[t].getX(),r=this.bases[e].getY()-this.bases[t].getY(),s=Math.sqrt(n*n+r*r),p=e-t,p<0&&(p+=this.nbase+1),s>=p)for(n/=s,r/=s,f=1;f<p;f++)b=t+f,b>this.nbase&&(b-=this.nbase+1),this.bases[b].setX(this.bases[t].getX()+n*f/p),this.bases[b].setY(this.bases[t].getY()+r*f/p);else for(this.find_center_for_arc(p-1,s),n/=s,r/=s,o=this.bases[t].getX()+n*s/2,i=this.bases[t].getY()+r*s/2,a=r,u=-n,l=o+this._h*a,c=i+this._h*u,h=this.bases[t].getX()-l,d=this.bases[t].getY()-c,s=Math.sqrt(h*h+d*d),g=Math.atan2(d,h),f=1;f<p;f++)b=t+f,b>this.nbase&&(b-=this.nbase+1),this.bases[b].setX(l+s*Math.cos(g+f*this.angleinc)),this.bases[b].setY(c+s*Math.sin(g+f*this.angleinc))},r.prototype.find_center_for_arc=function(t,e){var n,r,s,o,i,a,u,l,c;r=(t+1)/Math.PI,s=-r-e/(t+1.000001-e),e<1&&(s=0),c=0;do n=(r+s)/2,o=Math.sqrt(n*n+e*e/4),i=1-.5/(o*o),Math.abs(i)>1&&console.log("Unexpected large magnitude discriminant = "+i+" "+o),a=Math.acos(i),l=Math.acos(n/o),u=a*(t+1)+2*l-2*Math.PI,u>0?s=n:r=n;while(Math.abs(u)>1e-4&&++c<this.MAXITER);c>=this.MAXITER&&(noIterationFailureYet&&(console.log("Iteration failed in find_center_for_arc"),noIterationFailureYet=!1),n=0,a=0),this._h=n,this.angleinc=a},r.prototype.generate_region=function(t){var e,n,r,s,o,i;for(i=t.getRegion(),e=0,t.getStart()==i.getStart1()?(n=i.getStart1(),r=i.getEnd1()):(n=i.getStart2(),r=i.getEnd2()),(this.bases[t.getStart()].getX()>this.ANUM-100||this.bases[t.getEnd()].getX()>this.ANUM-100)&&console.log("Bad region passed to generate_region. Coordinates not defined."),s=n+1;s<=r;s++)e++,this.bases[s].setX(this.bases[t.getStart()].getX()+this.HELIX_FACTOR*e*t.getXrad()),this.bases[s].setY(this.bases[t.getStart()].getY()+this.HELIX_FACTOR*e*t.getYrad()),o=this.bases[s].getMate(),this.bases[o].setX(this.bases[t.getEnd()].getX()+this.HELIX_FACTOR*e*t.getXrad()),this.bases[o].setY(this.bases[t.getEnd()].getY()+this.HELIX_FACTOR*e*t.getYrad())},r.prototype.minf2=function(t,e){return t<e?t:e},r.prototype.maxf2=function(t,e){return t>e?t:e},r.prototype.connected_connection=function(t,e){return!!t.isExtruded()||t.getEnd()+1==e.getStart()}},function(t,e){"use strict";function n(){this.radius=null,this.loopnumber=null,this.next=null,this.prev=null}Object.defineProperty(e,"__esModule",{value:!0}),e.Radloop=n,n.prototype.getRadius=function(){return this.radius},n.prototype.setRadius=function(t){this.radius=t},n.prototype.getLoopnumber=function(){return this.loopnumber},n.prototype.setLoopnumber=function(t){this.loopnumber=t},n.prototype.getNext=function(){return this.next},n.prototype.setNext=function(t){this.next=t},n.prototype.getPrev=function(){return this.prev},n.prototype.setPrev=function(t){this.prev=t}},function(t,e,n){"use strict";function r(){this.loop=new s.Loop,this.region=new o.Region,this.start=null,this.end=null,this.xrad=null,this.yrad=null,this.angle=null,this.extruded=null,this.broken=null,this._isNull=!1}Object.defineProperty(e,"__esModule",{value:!0}),e.Connection=r;var s=n(8),o=n(9);r.prototype.isNull=function(){return this._isNull},r.prototype.setNull=function(t){this._isNull=t},r.prototype.getLoop=function(){return this.loop},r.prototype.setLoop=function(t){this.loop=t},r.prototype.getRegion=function(){return this.region},r.prototype.setRegion=function(t){this.region=t},r.prototype.getStart=function(){return this.start},r.prototype.setStart=function(t){this.start=t},r.prototype.getEnd=function(){return this.end},r.prototype.setEnd=function(t){this.end=t},r.prototype.getXrad=function(){return this.xrad},r.prototype.setXrad=function(t){this.xrad=t},r.prototype.getYrad=function(){return this.yrad},r.prototype.setYrad=function(t){this.yrad=t},r.prototype.getAngle=function(){return this.angle},r.prototype.setAngle=function(t){this.angle=t},r.prototype.isExtruded=function(){return this.extruded},r.prototype.setExtruded=function(t){this.extruded=t},r.prototype.isBroken=function(){return this.broken},r.prototype.setBroken=function(t){this.broken=t}},function(t,e,n){"use strict";function r(){this.nconnection=null,this.connections=[],this._connections=[],this.number=null,this.depth=null,this.mark=null,this.x=null,this.y=null,this.radius=null}Object.defineProperty(e,"__esModule",{value:!0}),e.Loop=r;var s=n(7);r.prototype.getNconnection=function(){return this.nconnection},r.prototype.setNconnection=function(t){this.nconnection=t},r.prototype.setConnection=function(t,e){null!=e?this._connections[t]=e:(this._connections[t]||(this._connections[t]=new s.Connection),this._connections[t].setNull(!0))},r.prototype.getConnection=function(t){var e=n(7);this._connections[t]||(this._connections[t]=new e);var r=this._connections[t];return r.isNull()?null:r},r.prototype.addConnection=function(t,e){this._connections.push(e)},r.prototype.getNumber=function(){return this.number},r.prototype.setNumber=function(t){this.number=t},r.prototype.getDepth=function(){return this.depth},r.prototype.setDepth=function(t){this.depth=t},r.prototype.isMark=function(){return this.mark},r.prototype.setMark=function(t){this.mark=t},r.prototype.getX=function(){return this.x},r.prototype.setX=function(t){this.x=t},r.prototype.getY=function(){return this.y},r.prototype.setY=function(t){this.y=t},r.prototype.getRadius=function(){return this.radius},r.prototype.setRadius=function(t){this.radius=t}},function(t,e){"use strict";function n(){this._start1=null,this._end1=null,this._start2=null,this._end2=null}Object.defineProperty(e,"__esModule",{value:!0}),e.Region=n,n.prototype.getStart1=function(){return this._start1},n.prototype.setStart1=function(t){this._start1=t},n.prototype.getEnd1=function(){return this._end1},n.prototype.setEnd1=function(t){this._end1=t},n.prototype.getStart2=function(){return this._start2},n.prototype.setStart2=function(t){this._start2=t},n.prototype.getEnd2=function(){return this._end2},n.prototype.setEnd2=function(t){this._end2=t}},function(t,e,n){"use strict";function r(){this.mate=null,this.x=null,this.y=null,this.extracted=null,this.region=new s.Region}Object.defineProperty(e,"__esModule",{value:!0}),e.Base=r;var s=n(9);r.prototype.getMate=function(){return this.mate},r.prototype.setMate=function(t){this.mate=t},r.prototype.getX=function(){return this.x},r.prototype.setX=function(t){this.x=t},r.prototype.getY=function(){return this.y},r.prototype.setY=function(t){this.y=t},r.prototype.isExtracted=function(){return this.extracted},r.prototype.setExtracted=function(t){this.extracted=t},r.prototype.getRegion=function(){return this.region},r.prototype.setRegion=function(t){this.region=t}},function(t,e,n){var r=n(12);"string"==typeof r&&(r=[[t.id,r,""]]);n(14)(r,{});r.locals&&(t.exports=r.locals)},function(t,e,n){e=t.exports=n(13)(),e.push([t.id,'.structure-background-rect {\n    stroke: black;\n    stroke-width: 5;\n    fill: transparent;\n}\n\ncircle.rna-base {\n  stroke: #ccc;\n  stroke-width: 1px;\n  opacity: 1;\n  fill: white;\n}\n\ncircle.rna-base.label {\n    stroke: transparent;\n    stroke-width: 0;\n    fill: white;\n}\n\nline.link {\n  stroke: #999;\n  stroke-opacity: 0.8;\n  stroke-width: 2;\n}\n\nline.rna-link {\n  stroke: #999;\n  stroke-opacity: 0.8;\n  stroke-width: 2;\n}\n\n.overlay {\n    fill: transparent;\n}\n\n.rna-name {\n    text-anchor: middle;\n    dy: -10;\n    font-family: Tahoma, Geneva, sans-serif;\n    font-size: 8pt;\n}\n\nline.rna-link[link-type="backbone"] {\n    stroke: transparent;\n}\n\nline.rna-link[link-type="basepair"] {\n    stroke: transparent;\n}\n\nline.rna-link[link-type="fake"] {\n    stroke: transparent;\n}\n\nline.rna-link[link-type="extra"] {\n    stroke: grey;\n}\n\nline.rna-link[extra-link-type="correct"] {\n    stroke: green;\n}\n\nline.rna-link[extra-link-type="incorrect"] {\n    stroke: green;\n}\n\n\npath {\n    stroke: grey;\n  stroke-width: 2;\n}\n\npath[extra-link-type="correct"] {\n    stroke: green;\n}\n\npath[extra-link-type="incorrect"] {\n    stroke: red;\n}\n\n\nline.basepair {\n  stroke: red;\n}\n\nline.intermolecule {\n  stroke: blue;\n}\n\nline.chain_chain {\n  stroke-dasharray: 3,3;\n}\n\nline.fake {\n  stroke: green;\n}\n\n.transparent {\n    fill: transparent;\n    stroke-width: 0;\n    stroke-opacity: 0;\n    opacity: 0;\n}\n\n.d3-tip {\n    line-height: 1;\n    font-weight: bold;\n    padding: 6px;\n    background: rgba(0, 0, 0, 0.6);\n    color: #fff;\n    border-radius: 4px;\n    pointer-events: none;\n          }\n\ntext.nucleotide-label {\n    font-size: 5.5pt;\n    font-weight: bold;\n    font-family: Tahoma, Geneva, sans-serif;\n    color: rgb(100,100,100);\n    pointer-events: none;\n}\n\ntext.number-label {\n    font-size: 5.5pt;\n    font-weight: bold;\n    font-family: Tahoma, Geneva, sans-serif;\n    color: rgb(100,100,100);\n    pointer-events: none;\n}\n\ntext {\n    pointer-events: none;\n}\n\ng.gnode {\n\n}\n\n.brush .extent {\n  fill-opacity: .1;\n  stroke: #fff;\n  shape-rendering: crispEdges;\n}\n\n.noselect {\n    -webkit-touch-callout: none;\n    -webkit-user-select: none;\n    -khtml-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n}\n',""])},function(t,e){t.exports=function(){var t=[];return t.toString=function(){for(var t=[],e=0;e<this.length;e++){var n=this[e];n[2]?t.push("@media "+n[2]+"{"+n[1]+"}"):t.push(n[1])}return t.join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var r={},s=0;s<this.length;s++){var o=this[s][0];"number"==typeof o&&(r[o]=!0)}for(s=0;s<e.length;s++){var i=e[s];"number"==typeof i[0]&&r[i[0]]||(n&&!i[2]?i[2]=n:n&&(i[2]="("+i[2]+") and ("+n+")"),t.push(i))}},t}},function(t,e,n){function r(t,e){for(var n=0;n<t.length;n++){var r=t[n],s=g[r.id];if(s){s.refs++;for(var o=0;o<s.parts.length;o++)s.parts[o](r.parts[o]);for(;o<r.parts.length;o++)s.parts.push(l(r.parts[o],e))}else{for(var i=[],o=0;o<r.parts.length;o++)i.push(l(r.parts[o],e));g[r.id]={id:r.id,refs:1,parts:i}}}}function s(t){for(var e=[],n={},r=0;r<t.length;r++){var s=t[r],o=s[0],i=s[1],a=s[2],u=s[3],l={css:i,media:a,sourceMap:u};n[o]?n[o].parts.push(l):e.push(n[o]={id:o,parts:[l]})}return e}function o(t,e){var n=b(),r=v[v.length-1];if("top"===t.insertAt)r?r.nextSibling?n.insertBefore(e,r.nextSibling):n.appendChild(e):n.insertBefore(e,n.firstChild),v.push(e);else{if("bottom"!==t.insertAt)throw new Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");n.appendChild(e)}}function i(t){t.parentNode.removeChild(t);var e=v.indexOf(t);e>=0&&v.splice(e,1)}function a(t){var e=document.createElement("style");return e.type="text/css",o(t,e),e}function u(t){var e=document.createElement("link");return e.rel="stylesheet",o(t,e),e}function l(t,e){var n,r,s;if(e.singleton){var o=m++;n=y||(y=a(e)),r=c.bind(null,n,o,!1),s=c.bind(null,n,o,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=u(e),r=d.bind(null,n),s=function(){i(n),n.href&&URL.revokeObjectURL(n.href)}):(n=a(e),r=h.bind(null,n),s=function(){i(n)});return r(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;r(t=e)}else s()}}function c(t,e,n,r){var s=n?"":r.css;if(t.styleSheet)t.styleSheet.cssText=k(e,s);else{var o=document.createTextNode(s),i=t.childNodes;i[e]&&t.removeChild(i[e]),i.length?t.insertBefore(o,i[e]):t.appendChild(o)}}function h(t,e){var n=e.css,r=e.media;if(r&&t.setAttribute("media",r),t.styleSheet)t.styleSheet.cssText=n;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}function d(t,e){var n=e.css,r=e.sourceMap;r&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */");var s=new Blob([n],{type:"text/css"}),o=t.href;t.href=URL.createObjectURL(s),o&&URL.revokeObjectURL(o)}var g={},p=function(t){var e;return function(){return"undefined"==typeof e&&(e=t.apply(this,arguments)),e}},f=p(function(){return/msie [6-9]\b/.test(window.navigator.userAgent.toLowerCase())}),b=p(function(){return document.head||document.getElementsByTagName("head")[0]}),y=null,m=0,v=[];t.exports=function(t,e){e=e||{},"undefined"==typeof e.singleton&&(e.singleton=f()),"undefined"==typeof e.insertAt&&(e.insertAt="bottom");var n=s(t);return r(n,e),function(t){for(var o=[],i=0;i<n.length;i++){var a=n[i],u=g[a.id];u.refs--,o.push(u)}if(t){var l=s(t);r(l,e)}for(var i=0;i<o.length;i++){var u=o[i];if(0===u.refs){for(var c=0;c<u.parts.length;c++)u.parts[c]();delete g[u.id]}}}};var k=function(){var t=[];return function(e,n){return t[e]=n,t.filter(Boolean).join("\n")}}()}])});